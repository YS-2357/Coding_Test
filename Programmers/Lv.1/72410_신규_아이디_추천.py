# 72410_ì‹ ê·œ_ì•„ì´ë””_ì¶”ì²œ.py
# -----------------------------------------------------
# âœ… ì œëª©: ì‹ ê·œ ì•„ì´ë”” ì¶”ì²œ â€” ë¬¸ìžì—´ ê·œì¹™ ë³€í™˜
# âœ… ë¬¸ì œ ì„¤ëª…(ìš”ì•½):
# - ì£¼ì–´ì§„ new_id ë¬¸ìžì—´ì„ ê·œì¹™ 7ë‹¨ê³„(ì†Œë¬¸ìží™” â†’ í—ˆìš© ë¬¸ìž ì œì™¸ ì œê±° â†’ ì—°ì† ë§ˆì¹¨í‘œ ì¶•ì•½ â†’ ì–‘ ë ë§ˆì¹¨í‘œ ì œê±° â†’ ë¹ˆ ë¬¸ìžì—´ ì²˜ë¦¬ â†’ ê¸¸ì´ ì¡°ì • â†’ ê¸¸ì´ ìµœì†Œ ë³´ìž¥)ë¡œ ë³€í™˜í•´ ìµœì¢… ì¶”ì²œ ì•„ì´ë””ë¥¼ ë°˜í™˜í•œë‹¤.
#
# âœ… ìž…ë ¥ í˜•ì‹(ìš”ì§€):
# - new_id: str  (ê¸¸ì´ 1~1000, ì˜ë¬¸ ëŒ€ì†Œë¬¸ìž/ìˆ«ìž/íŠ¹ìˆ˜ë¬¸ìž í˜¼í•©)
#
# âœ… ê·œì¹™ ìš”ì•½:
# 1. ëª¨ë“  ëŒ€ë¬¸ìžë¥¼ ì†Œë¬¸ìžë¡œ ì¹˜í™˜
# 2. í—ˆìš© ë¬¸ìž(`ì†Œë¬¸ìž, ìˆ«ìž, -, _, .`) ì™¸ ì œê±°
# 3. ì—°ì†ëœ `.`ì€ í•˜ë‚˜ë¡œ ì¶•ì•½
# 4. ë¬¸ìžì—´ ì–‘ ëì˜ `.` ì œê±°
# 5. ë¹ˆ ë¬¸ìžì—´ì´ë©´ `"a"`
# 6. ê¸¸ì´ê°€ 16 ì´ìƒì´ë©´ ì•ž 15ìžë¡œ ìžë¥´ê³ , ë‹¤ì‹œ ëì˜ `.` ì œê±°
# 7. ê¸¸ì´ê°€ 2 ì´í•˜ë¼ë©´ ë§ˆì§€ë§‰ ë¬¸ìžë¥¼ ë°˜ë³µí•´ ê¸¸ì´ê°€ 3ì´ ë˜ë„ë¡
#
# âœ… ìž…ì¶œë ¥ ì˜ˆì‹œ(ê°„ë‹¨):
# - ìž…ë ¥: "...!@BaT#*..y.abcdefghijklm"
# - ì¶œë ¥: "bat.y.abcdefghi"
#
# âœ… ì •ë‹µ ì½”ë“œ (ì›ë³¸ ê·¸ëŒ€ë¡œ ìœ ì§€)
import re

def solution(new_id):
    # 1
    new_id = new_id.lower()
    # 2 
    new_id = re.sub(r'[^a-z0-9\-_.]', '', new_id)
    # 3
    while '..' in new_id:
        new_id = new_id.replace('..', '.')
    # 4
    if new_id.startswith('.'):
        new_id = new_id[1:]
    if new_id.endswith('.'):
        new_id = new_id[:-1]
    # 5
    if not new_id:
        new_id = "a"
    # 6
    if len(new_id) >= 16:
        new_id = new_id[:15]
        if new_id.endswith('.'):
            new_id = new_id[:-1]
    # 7
    while len(new_id) <= 2:
        new_id += new_id[-1]
    return new_id

# -----------------------------------------------------
# ðŸ” ì²« ì‹œë„ ê²°ê³¼:
# - í•œ ë²ˆì— ì •ë‹µ **ë„ë‹¬**
#
# ðŸ“š ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ ê¼­ í•„ìš”í•œ ê°œë… & ì´ í’€ì´ì—ì„œ ì‚¬ìš©í•œ ê°œë…(ìµœì†Œ):
# - ë¬¸ìžì—´ ì •ê·œì‹ í•„í„°ë§: `re.sub(r'[^a-z0-9\-_.]', '', s)`ìœ¼ë¡œ ë¶ˆí•„ìš” ë¬¸ìž ì œê±°
# - ë¬¸ìžì—´ ì¹˜í™˜/ìŠ¬ë¼ì´ì‹±ì„ í†µí•œ ê·œì¹™ì  ì „ì²˜ë¦¬
# - ë°˜ë³µì  ê²€ì‚¬(`while '..' in s`)ë¡œ ì—°ì† ë§ˆì¹¨í‘œ ì¶•ì•½
# - ì¡°ê±´ ë¶„ê¸°(`startswith`, `endswith`)ë¡œ ì–‘ ë ë§ˆì¹¨í‘œ ì²˜ë¦¬
# - ë¬¸ìžì—´ ê¸¸ì´ ë³´ì •: ìŠ¬ë¼ì´ì‹±, ë°˜ë³µë¬¸ìœ¼ë¡œ ê¸¸ì´ ìµœì†Œ ë³´ìž¥

# -----------------------------------------------------
# ë‹¤ë¥¸ í’€ì´ 1
# def solution(new_id):
#     answer = ''
#     # 1
#     new_id = new_id.lower()
#     # 2
#     for c in new_id:
#         if c.isalpha() or c.isdigit() or c in ['-', '_', '.']:
#             answer += c
#     # 3
#     while '..' in answer:
#         answer = answer.replace('..', '.')
#     # 4
#     if answer[0] == '.':
#         answer = answer[1:] if len(answer) > 1 else '.'
#     if answer[-1] == '.':
#         answer = answer[:-1]
#     # 5
#     if answer == '':
#         answer = 'a'
#     # 6
#     if len(answer) > 15:
#         answer = answer[:15]
#         if answer[-1] == '.':
#             answer = answer[:-1]
#     # 7
#     while len(answer) < 3:
#        answer += answer[-1]
#    return answer

# ë‹¤ë¥¸ í’€ì´ 2
# import re

# def solution(new_id):
#     st = new_id
#     st = st.lower()
#     st = re.sub('[^a-z0-9\-_.]', '', st)
#     st = re.sub('\.+', '.', st)
#     st = re.sub('^[.]|[.]$', '', st)
#     st = 'a' if len(st) == 0 else st[:15]
#     st = re.sub('^[.]|[.]$', '', st)
#     st = st if len(st) > 2 else st + "".join([st[-1] for i in range(3-len(st))])
#     return st
