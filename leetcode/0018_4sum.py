# 0018_4sum.py
# -----------------------------------------------------
# β… μ λ©: 4Sum
# β… λ¬Έμ  μ„¤λ…(μ”μ•½):
# - μ •μ λ°°μ—΄ numsμ™€ μ •μ targetμ΄ μ£Όμ–΄μ§ λ•,
#   ν•©μ΄ targetμ΄ λλ” μ„λ΅ λ‹¤λ¥Έ λ„¤ μ [a,b,c,d]μ μ΅°ν•©μ„ λ¨λ‘ λ°ν™ν•λ‹¤.
# - κ²°κ³Ό λ‚΄ μ¤‘λ³µ μ΅°ν•©μ€ ν—μ©λμ§€ μ•λ”λ‹¤.
#
# β… μ…λ ¥ ν•μ‹(μ”μ§€):
# - nums: List[int], κΈΈμ΄ n (n β‰¥ 4)
# - target: int
#
# β… κ·μΉ™ μ”μ•½:
# 1) λ°°μ—΄μ„ μ •λ ¬ν•μ—¬ μ¤‘λ³µ μ κ±°μ™€ ν¬ ν¬μΈν„° μ μ©μ„ μ©μ΄ν•κ² ν•λ‹¤.
# 2) i, j λ¥Ό κ³ μ •ν•κ³  λ‚λ¨Έμ§€ λ‘ μλ” left/right ν¬ ν¬μΈν„°λ΅ μ°Ύλ”λ‹¤.
# 3) i, j, left, right κ°κ°μ—μ„ κ°™μ€ κ°’μ€ μ¤ν‚µν•μ—¬ μ¤‘λ³µ μ΅°ν•©μ„ μλ°©ν•λ‹¤.
# 4) μµμ†/μµλ€ ν•©μΌλ΅ κ°€μ§€μΉκΈ°(pruning)ν•μ—¬ λ¶ν•„μ”ν• νƒμƒ‰μ„ μ¤„μΈλ‹¤.
#
# β… μ…μ¶λ ¥ μμ‹(1κ°):
# - nums = [1,0,-1,0,-2,2], target = 0
#   β†’ [[-2,-1,1,2], [-2,0,0,2], [-1,0,0,1]]
#
# β… μ •λ‹µ μ½”λ“(λ„μ ν’€μ΄; ν• μ¤„λ§λ‹¤ μ£Όμ„):
class Solution:
    def fourSum(self, nums: List[int], target: int) -> List[List[int]]:
        nums.sort()                                        # μ •λ ¬: μ¤‘λ³µμ κ±°/ν¬ν¬μΈν„° μ „μ 
        n = len(nums)
        answer = []                                        # μ •λ‹µ μ΅°ν•©λ“¤μ„ λ‹΄μ„ λ¦¬μ¤νΈ

        for i in range(n-3):                               # μ²« λ²μ§Έ κ³ μ • μΈλ±μ¤ i (0..n-4)
            if i > 0 and nums[i] == nums[i-1]: continue   # i μ¤‘λ³µ κ°’ μ¤ν‚µ

            # i-λ λ²¨ κ°€μ§€μΉκΈ°: κ°€μ¥ μ‘μ€ 3κ°/κ°€μ¥ ν° 3κ°μ™€μ ν•©μΌλ΅ λ¶κ°€λ¥ νμ •
            if nums[i] + nums[i+1] + nums[i+2] + nums[i+3] > target: break
            if nums[i] + nums[n-3] + nums[n-2] + nums[n-1] < target: continue

            for j in range(i+1, n-2):                     # λ‘ λ²μ§Έ κ³ μ • μΈλ±μ¤ j (i+1..n-3)
                if j > i + 1 and nums[j] == nums[j-1]: continue  # j μ¤‘λ³µ κ°’ μ¤ν‚µ

                # j-λ λ²¨ κ°€μ§€μΉκΈ°: λ‚¨μ€ 2κ° μµμ†/μµλ€ λ”ν•΄ λ¶κ°€λ¥ νμ •
                if nums[i] + nums[j] + nums[j+1] + nums[j+2] > target: break
                if nums[i] + nums[j] + nums[n-2] + nums[n-1] < target: continue

                left, right = j + 1, n - 1                # ν¬ ν¬μΈν„° μ‹μ‘

                while left < right:
                    s = nums[i] + nums[j] + nums[left] + nums[right]  # ν„μ¬ 4μμ ν•©

                    if s == target and [nums[i], nums[j], nums[left], nums[right]] not in answer:
                        # ν•©μ΄ μ •ν™•ν targetμ΄κ³ (μ¤‘λ³µ μλ°©μ„ μ„ν•΄ answerμ— μ΅΄μ¬ μ—¬λ¶€λ„ μ²΄ν¬)
                        answer.append([nums[i], nums[j], nums[left], nums[right]])  # μ •λ‹µ μ¶”κ°€
                        left += 1
                        right -= 1
                        # left/right μ¤‘λ³µ κ°’ μ¤ν‚µ
                        while left < right and nums[left] == nums[left - 1]:
                            left += 1
                        while left < right and nums[right] == nums[right + 1]:
                            right -= 1
                    elif s < target:
                        left += 1                          # ν•©μ΄ μ‘μΌλ©΄ λ” ν¬κ² (left++)
                    else:
                        right -= 1                         # ν•©μ΄ ν¬λ©΄ λ” μ‘κ² (right--)
        return answer                                      # λ¨λ“  μ΅°ν•© λ°ν™

# -----------------------------------------------------
# π” μ²« μ‹λ„ κ²°κ³Ό:
# - μλ»λ κ°€μ§€μΉκΈ°(μ: nums[i] > target μ¦‰μ‹ break)λ΅ ν•΄λ¥Ό λ„λ½ν•  μ μμ—μ.
#   ν„μ¬ λ²„μ „μ€ i/j λ λ²¨μ—μ„ μµμ†/μµλ€ ν•© κΈ°λ° κ°€μ§€μΉκΈ°λ΅ μ•μ •ν™”.
#
# π”§ μ¤λ‹µ λ° μ‹¤μ(λ¬΄μ—‡μ„ ν‹€λ Έκ³  μ–΄λ–»κ² κ³ μ³¤λ”μ§€):
# - (μ΄μ „) iλ§ μ¤‘λ³µ μ¤ν‚µ β†’ j/left/right μ¤‘λ³µμΌλ΅ λ™μΌ μ΅°ν•© λ°λ³µ λ°μƒ κ°€λ¥.
#   β†’ j/left/right μ¤‘λ³µ μ¤ν‚µ μ¶”κ°€λ΅ μ¤‘λ³µ μ κ±°.
# - (μ΄μ „) λ£¨ν”„ λ°–/λ λ²¨ λ°– ν•© μ΅°κ±΄ λ―Έν΅ β†’ λ¶ν•„μ” νƒμƒ‰ κ³Όλ‹¤.
#   β†’ i/j λ λ²¨ ν”„λ£¨λ‹ 2μ‹μ”© μ¶”κ°€λ΅ νƒμƒ‰ μ¶•μ†.
#
# π’΅ κ°μ„  μ—¬μ§€(μ„ νƒ):
# - `[...] not in answer`λ” λ¦¬μ¤νΈ ν¬ν•¨ μ—¬λ¶€ O(k) κ²€μ‚¬λΌ λ¶ν•„μ”(μ΄λ―Έ μ¤‘λ³µ μ¤ν‚µμΌλ΅ λ°©μ§€λ¨).
#   μ κ±°ν•λ©΄ μƒμ μ‹κ°„ κ°μ„  κ°€λ¥.
#
# π“ μ‚¬μ©λ/ν•„μ κ°λ…(μµμ†):
# - μ •λ ¬(Sorting) + ν¬ ν¬μΈν„°(Two Pointers)
# - λ‹¤μ¤‘ λ λ²¨ μ¤‘λ³µ μ κ±°(i, j, left, right)
# - κ°€μ§€μΉκΈ°(μµμ†/μµλ€ ν•© κΈ°λ°)
# - μ‹κ°„λ³µμ΅λ„: O(n^3), κ³µκ°„λ³µμ΅λ„: O(1) (μ •λ‹µ μ €μ¥ μ μ™Έ)
