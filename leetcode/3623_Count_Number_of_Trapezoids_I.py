# 3623_Count_Number_of_Trapezoids_I.py
# -----------------------------------------------------
# ✅ 제목: LeetCode 3623. Count Number of Trapezoids I
# -----------------------------------------------------
# ✅ 문제 설명(요약):
#   - 2D 평면에 n개의 점이 주어진다.
#   - 적어도 한 쌍의 변이 수평(horizontal)인 사다리꼴(trapezoid)의 개수를 구한다.
#   - 즉, y좌표가 같은 두 점으로 이루어진 수평선 두 개를 선택하면 사다리꼴이 형성된다.
#
# ✅ 입력 형식(요지):
#   - points: List[List[int]] 형태이며 각 원소는 [x, y] 좌표.
#
# ✅ 규칙 요약:
#   - 같은 y값에 있는 점 c개 → 만들 수 있는 수평선 수 = c * (c - 1) // 2
#   - 서로 다른 y 레벨에서 생성된 수평선 쌍을 조합하여 사다리꼴 수를 계산.
#   - n 최대 10^5 이상에서도 통과 가능한 O(n) ~ O(n log n) 수준 요구.
#
# -----------------------------------------------------
# ✅ 정답 코드 (사용자 풀이 — 절대 수정 금지, 주석만 추가)
# -----------------------------------------------------
class Solution:
    def countTrapezoids(self, points: List[List[int]]) -> int:
        point_num = defaultdict(int)          # 각 y좌표별로 점의 개수를 세기 위한 딕셔너리
        MOD = 10**9 + 7                       # 문제에서 요구하는 모듈러 연산
        ans, total_sum = 0, 0                 # ans: 최종 사다리꼴 수, total_sum: 누적 수평선 수

        for point in points:
            point_num[point[1]] += 1          # 같은 y값을 가진 점의 개수를 카운트

        for p_num in point_num.values():
            edge = p_num * (p_num - 1) // 2   # 해당 y층에서 만들 수 있는 수평선 개수 = 조합 C(p_num, 2)
            ans = (ans + edge * total_sum) % MOD  
            # 현재 y층에서 생성된 수평선(edge) × 이전 y층까지 누적된 수평선(total_sum)
            # → 두 층을 묶어 만들 수 있는 모든 사다리꼴 수를 더함

            total_sum = (total_sum + edge) % MOD  
            # 현재 층의 수평선을 누적하여 다음 층 계산에 사용

        return ans                            # 최종 사다리꼴 수 반환

# -----------------------------------------------------
# 🔍 첫 시도 결과:
#   - Editorial의 핵심 공식을 정확히 구현하여 정답 처리.
#   - 모든 y값을 그룹핑하고, 각 층의 수평선 개수를 누적 곱 방식으로 결합.
#
# 🔧 오답 이유 및 사용한 알고리즘 개념:
#   - 이전 접근에서 slope 비교 및 선분 조합 방식은 O(n^2)~O(n^4)로 불가능.
#   - 문제는 "horizontal trapezoid"만 요구하므로 slope 전체를 계산할 필요가 없다.
#   - 핵심은 "같은 y에서 선 몇 개가 만들어지는지"만 보면 되며,
#     이를 다른 y층과 조합하여 사다리꼴 수를 누적 곱으로 계산한다.
#   - 사용 개념:
#       • 조합 계산: C(n, 2)
#       • 누적 합 기반 곱 구조(prefix combination accumulation)
#       • 해시 기반 그룹핑(defaultdict)
#
# 📚 시간·공간 복잡도:
#   - 시간 복잡도: O(n) (y좌표 카운트 + y층 반복)
#   - 공간 복잡도: O(k) (k = 서로 다른 y값의 개수)
#
# -----------------------------------------------------
# (선택) 다른 효율적 풀이 또는 알고리즘 제안:
#   - 동일한 핵심 아이디어로 y값을 정렬하여도 계산 방식은 같다.
#   - 더 확장된 버전(Trapezoids II)에서는 slope 분류가 필요하며,
#     이 문제(I)는 "horizontal-only"여서 조합 누적 방식이 최적이다.
# -----------------------------------------------------
