# 1792_maximum_average_pass_ratio.py
# -----------------------------------------------------
# âœ… ì œëª©: Maximum Average Pass Ratio
# âœ… ë¬¸ì œ ì„¤ëª…(ìš”ì•½):
# - ê° ë°˜ì— ëŒ€í•´ í•©ê²©ì ìˆ˜ a, ì´ í•™ìƒ ìˆ˜ bê°€ ì£¼ì–´ì§„ë‹¤.
# - ì¶”ê°€ í•™ìƒ extraStudentsëª…ì„ ì„ì˜ë¡œ ë°°ì¹˜í•  ìˆ˜ ìˆë‹¤.
# - í•™ìƒì„ ë°°ì¹˜í•˜ë©´ (a+1)/(b+1)ë¡œ ê°±ì‹ ëœë‹¤(ì¦‰, í•©ê²©ìë¡œ ì¶”ê°€ë¨).
# - ì „ì²´ í‰ê·  í•©ê²©ë¥ (ëª¨ë“  ë°˜ì˜ í•©ê²©ë¥  í‰ê· )ì„ ìµœëŒ€ë¡œ í•˜ëŠ” ê°’ì„ ë°˜í™˜í•œë‹¤.
#
# âœ… ì…ë ¥ í˜•ì‹(ìš”ì§€):
# - classes: List[List[int]] (ê° ì›ì†ŒëŠ” [a, b], 1 â‰¤ a â‰¤ b)
# - extraStudents: int (ì¶”ê°€ í•™ìƒ ìˆ˜)
#
# âœ… ê·œì¹™ ìš”ì•½:
# 1) í•™ìƒì€ í•œ ë²ˆì— 1ëª…ì”©, ë°˜ë“œì‹œ ì–´ë–¤ ë°˜ì— ë°°ì •.
# 2) ê° ë°°ì •ì—ì„œ â€œì´ë“â€ì´ ê°€ì¥ í° ë°˜ì— ìš°ì„  ë°°ì¹˜í•´ì•¼ í‰ê· ì´ ìµœëŒ€.
#    - ì´ë“ Î” = (a+1)/(b+1) - a/b = (b-a) / (b*(b+1))
#
# âœ… ì…ì¶œë ¥ ì˜ˆì‹œ(1ê°œ):
# - classes = [[1,2],[3,5],[2,2]], extraStudents=2
#   â†’ ìµœì  ë°°ì¹˜ í›„ í‰ê·  í•©ê²©ë¥  â‰ˆ 0.78333
#
# âœ… ì •ë‹µ ì½”ë“œ(ë„ˆì˜ í’€ì´; í•œ ì¤„ë§ˆë‹¤ ì£¼ì„):
import heapq

class Solution:
    def maxAverageRatio(self, classes: List[List[int]], extraStudents: int) -> float:
        n = len(classes)

        def gain(a, b):
            # (a+1)/(b+1) - a/b = (b - a) / (b*(b+1))
            return (b - a) / (b * (b + 1))

        heap = []
        for a, b in classes:
            heapq.heappush(heap, (-gain(a, b), a, b))        # ìµœëŒ€ ì´ë“ ê¸°ì¤€ í™(ìŒìˆ˜ë¡œ ì €ì¥)

        for _ in range(extraStudents):                      # këª… ë°°ì¹˜
            g, a, b = heapq.heappop(heap)                   # ê°€ì¥ ì´ë“ í° ë°˜ êº¼ëƒ„
            a, b = a + 1, b + 1                             # í•™ìƒ 1ëª… ë°°ì •
            heapq.heappush(heap, (-gain(a, b), a, b))       # ê°±ì‹  í›„ ë‹¤ì‹œ í‘¸ì‹œ

        total = 0.0
        while heap:                                         # ìµœì¢… í•©ê²©ë¥  ê³„ì‚°
            _, a, b = heapq.heappop(heap)
            total += a / b

        answer = total / n                                  # ì „ì²´ í‰ê·  ë°˜í™˜
        return answer

# -----------------------------------------------------
# ğŸ” ì²« ì‹œë„ ê²°ê³¼:
# - í™ ê¸°ë°˜ íƒìš•ì  ë°°ì¹˜ë¡œ ë¬¸ì œ ì¡°ê±´ ì¶©ì¡±, ì •ë‹µ ë„ì¶œ ì„±ê³µ.
#
# ğŸ”§ ì˜¤ë‹µ ë° ì‹¤ìˆ˜(ë¬´ì—‡ì„ í‹€ë ¸ê³  ì–´ë–»ê²Œ ê³ ì³¤ëŠ”ì§€):
# - (ì—†ìŒ) ë‹¤ë§Œ gain ê³„ì‚°ì‹ ì˜¤íƒ€ ì£¼ì˜ í•„ìš”. (b-a)/(b*(b+1))ê°€ ì •í™•)
# - float ì˜¤ì°¨ëŠ” íŒŒì´ì¬ double precisionìœ¼ë¡œ ì¶©ë¶„.
#
# ğŸ“š ì‚¬ìš©ëœ/í•„ìˆ˜ ê°œë…(ìµœì†Œ):
# - íƒìš•ë²•(Greedy): ë§¤ë²ˆ í‰ê·  ì¦ê°€ëŸ‰ ìµœëŒ€ ë°˜ì— ë°°ì •
# - ìµœëŒ€ í™(heapqì— ìŒìˆ˜ push)
# - ì‹œê°„ë³µì¡ë„: O((n+k) log n), ê³µê°„ë³µì¡ë„: O(n)
