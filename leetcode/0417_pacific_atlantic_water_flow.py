# 0417_pacific_atlantic_water_flow.py
# -----------------------------------------------------
# âœ… ì œëª©: Pacific Atlantic Water Flow (LeetCode 417)
# âœ… ë¬¸ì œ ì„¤ëª…(ìš”ì•½):
# - ë†’ì´ ê²©ìì—ì„œ ê° ì¹¸ì˜ ë¬¼ì´ íƒœí‰ì–‘(ìƒ/ì¢Œ ê²½ê³„)ê³¼ ëŒ€ì„œì–‘(í•˜/ìš° ê²½ê³„) ëª¨ë‘ë¡œ í˜ëŸ¬ê°ˆ ìˆ˜ ìˆëŠ” ì¢Œí‘œë¥¼ êµ¬í•œë‹¤.
#
# âœ… ì…ë ¥ í˜•ì‹(ìš”ì§€):
# - heights: List[List[int]] í¬ê¸° mÃ—n, ê° ì›ì†ŒëŠ” ê³ ë„
#
# âœ… ê·œì¹™ ìš”ì•½:
# 1) ë¬¼ì€ ë„¤ ë°©í–¥ìœ¼ë¡œë§Œ íë¥´ë©°, ë†’ì€ ê³³â†’ë‚®ì€ ê³³ ë˜ëŠ” ê°™ì€ ë†’ì´ë¡œë§Œ ì´ë™ ê°€ëŠ¥(ë“±ê³ ì„  í¬í•¨).
# 2) íƒœí‰ì–‘ì€ ìƒë‹¨ í–‰ê³¼ ì¢Œì¸¡ ì—´ê³¼ ì ‘í•¨, ëŒ€ì„œì–‘ì€ í•˜ë‹¨ í–‰ê³¼ ìš°ì¸¡ ì—´ê³¼ ì ‘í•¨.
# 3) ë‘ ë°”ë‹¤ ëª¨ë‘ì— ë„ë‹¬ ê°€ëŠ¥í•œ ì¹¸ì„ ë°˜í™˜.
#
# âœ… ì •ë‹µ ì½”ë“œ(ë‚˜ì˜ í’€ì´; ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€) â€” í•œ ì¤„ ì£¼ì„ í¬í•¨
from collections import deque                                         # BFSìš© í

class Solution:
    def pacificAtlantic(self, heights: List[List[int]]) -> List[List[int]]:
        m, n = len(heights), len(heights[0])                          # ê²©ì í¬ê¸°
        pacific = deque()                                             # íƒœí‰ì–‘ ì‹œì‘ì  í
        atlantic = deque()                                            # ëŒ€ì„œì–‘ ì‹œì‘ì  í

        pacific_visited = [[False]*n for _ in range(m)]               # íƒœí‰ì–‘ ë„ë‹¬ ê°€ëŠ¥ í‘œì‹œ
        atlantic_visited = [[False]*n for _ in range(m)]              # ëŒ€ì„œì–‘ ë„ë‹¬ ê°€ëŠ¥ í‘œì‹œ

        for i in range(m):                                            # ì¢Œì¸¡ ì—´(íƒœí‰ì–‘) ì´ˆê¸°í™”
            pacific.append((i, 0))                                    # (i,0) enqueue
            pacific_visited[i][0] = True                              # ë°©ë¬¸ í‘œê¸°
        for j in range(n):                                            # ìƒë‹¨ í–‰(íƒœí‰ì–‘) ì´ˆê¸°í™”
            pacific.append((0, j))                                    # (0,j) enqueue
            pacific_visited[0][j] = True                              # ë°©ë¬¸ í‘œê¸°

        for i in range(m):                                            # ìš°ì¸¡ ì—´(ëŒ€ì„œì–‘) ì´ˆê¸°í™”
            atlantic.append((i, n-1))                                 # (i,n-1) enqueue
            atlantic_visited[i][n-1] = True                           # ë°©ë¬¸ í‘œê¸°
        for j in range(n):                                            # í•˜ë‹¨ í–‰(ëŒ€ì„œì–‘) ì´ˆê¸°í™”
            atlantic.append((m-1, j))                                 # (m-1,j) enqueue
            atlantic_visited[m-1][j] = True                           # ë°©ë¬¸ í‘œê¸°

        def bfs(q, visited):                                          # ê²½ê³„ì—ì„œ ì—­ë°©í–¥ìœ¼ë¡œ í¼ì§€ëŠ” BFS
            dirs = [(1,0),(-1,0),(0,1),(0,-1)]                        # 4ë°©í–¥ ì´ë™
            while q:                                                  # í ë¹Œ ë•Œê¹Œì§€
                x, y = q.popleft()                                    # í˜„ì¬ ì¹¸
                for dx, dy in dirs:                                   # ì´ì›ƒ ê²€ì‚¬
                    nx, ny = x+dx, y+dy                               # ì´ì›ƒ ì¢Œí‘œ
                    if 0<=nx<m and 0<=ny<n and not visited[nx][ny]:   # ë²”ìœ„ ë‚´, ë¯¸ë°©ë¬¸
                        if heights[nx][ny] >= heights[x][y]:          # ì—­ë°©í–¥ í™•ì¥: ë†’ê±°ë‚˜ ê°™ì€ ê³³ë§Œ
                            visited[nx][ny] = True                     # ë°©ë¬¸ í™•ì •
                            q.append((nx, ny))                         # íì— ì¶”ê°€

        bfs(pacific, pacific_visited)                                  # íƒœí‰ì–‘ì—ì„œ ë„ë‹¬ ê°€ëŠ¥í•œ ì¹¸ë“¤
        bfs(atlantic, atlantic_visited)                                # ëŒ€ì„œì–‘ì—ì„œ ë„ë‹¬ ê°€ëŠ¥í•œ ì¹¸ë“¤

        result = []                                                    # êµì§‘í•© ê²°ê³¼
        for i in range(m):                                             # ëª¨ë“  ì¹¸ ìˆœíšŒ
            for j in range(n):
                if pacific_visited[i][j] and atlantic_visited[i][j]:   # ë‘ ë°”ë‹¤ ëª¨ë‘ì— ë„ë‹¬í•˜ë©´
                    result.append([i, j])                               # ê²°ê³¼ì— ì¶”ê°€

        return result                                                  # ì •ë‹µ ë°˜í™˜

# -----------------------------------------------------
# ğŸ” ì²« ì‹œë„ ê²°ê³¼:
# - ë‘ ê²½ê³„ì—ì„œ BFS ì—­í™•ì¥ìœ¼ë¡œ êµì§‘í•© ì¢Œí‘œ ê³„ì‚° ì„±ê³µ.
#
# ğŸ”§ ì˜¤ë‹µ ì´ìœ  ë° ì‹¤ìˆ˜, ì‚¬ìš©í•œ ì•Œê³ ë¦¬ì¦˜ ê°œë…:
# - ê°œë…: ê²½ê³„ì—ì„œ ì‹œì‘í•´ "ë†’ê±°ë‚˜ ê°™ì€ ê³ ë„"ë¡œë§Œ ì´ë™í•˜ëŠ” BFSë¥¼ ê°ê° ìˆ˜í–‰.
# - ì‹¤ìˆ˜ ê°€ëŠ¥ ì§€ì :
#   1) ë°©ë¬¸ ë°°ì—´ì„ í•˜ë‚˜ë¡œ í•©ì¹˜ë©´ ì•ˆ ë¨(ë°”ë‹¤ë³„ë¡œ ë¶„ë¦¬ í•„ìš”).
#   2) ì¡°ê±´ì„ ë°˜ëŒ€ë¡œ ë‘ë©´ ì•ˆ ë¨(ì •ë°©í–¥ íë¦„ì´ ì•„ë‹ˆë¼ ì—­ë°©í–¥ í™•ì¥).
# - ì‹œê°„ë³µì¡ë„: O(mn) (ê° ì¹¸ì„ ìµœëŒ€ 2íšŒ ë°©ë¬¸)
# - ê³µê°„ë³µì¡ë„: O(mn) (visited 2ê°œ, í)
#
# -----------------------------------------------------
# (ì„ íƒ) ë‹¤ë¥¸ íš¨ìœ¨ì ì¸ í’€ì´ ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜ ì œì•ˆ:
# - DFSë¡œë„ ë™ì¼í•˜ê²Œ ê°€ëŠ¥. ë‹¨, íŒŒì´ì¬ì€ ì¬ê·€ ê¹Šì´ ì£¼ì˜.
# - ë¯¸ì„¸ ìµœì í™”: dirs ìƒìˆ˜í™”, ë¹„íŠ¸ ë°©ë¬¸í‘œì‹œë¡œ ë©”ëª¨ë¦¬ ì ˆì•½ ê°€ëŠ¥.
