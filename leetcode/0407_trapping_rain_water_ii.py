# 0407_trapping_rain_water_ii.py
# -----------------------------------------------------
# âœ… ì œëª©: Trapping Rain Water II (LeetCode 407)
# âœ… ë¬¸ì œ ì„¤ëª…(ìš”ì•½):
# - mÃ—n ê³ ë„ ì§€ë„ì—ì„œ ë¹—ë¬¼ì´ ê³ ì¼ ìˆ˜ ìˆëŠ” ì´ëŸ‰ì„ êµ¬í•œë‹¤.
# - ê²½ê³„ì—ì„œ ë¬¼ì´ ìƒˆì§€ ì•ŠëŠ” ì¡°ê±´ í•˜ì— ë‚´ë¶€ ì¹¸ ìœ„ë¡œ ê³ ì¼ ìˆ˜ ìˆëŠ” ë¬¼ì˜ ì–‘ì„ í•©ì‚°í•œë‹¤.
#
# âœ… ì…ë ¥ í˜•ì‹(ìš”ì§€):
# - heightMap: List[List[int]], í¬ê¸° mÃ—n (m,n â‰¥ 1)
#
# âœ… ê·œì¹™ ìš”ì•½:
# 1) ë¬¼ì€ ë„¤ ë°©í–¥ìœ¼ë¡œë§Œ í˜ëŸ¬ê°„ë‹¤.
# 2) ê²½ê³„ëŠ” ì™¸ë¶€ë¡œ ì—´ë ¤ ìˆìœ¼ë¯€ë¡œ â€œê°€ì¥ ë‚®ì€ ê²½ê³„ ë†’ì´â€ê°€ ìˆ˜ìœ„ë¥¼ ê²°ì •í•œë‹¤.
# 3) ê° ì¹¸ì˜ ë¬¼ ë†’ì´ = max(0, ê²½ê³„ìˆ˜ìœ„ âˆ’ ê³ ë„).
#
# âœ… ì •ë‹µ ì½”ë“œ(ë‚˜ì˜ í’€ì´; ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€)
import heapq as hq  # ìµœì†Œ í™ ì‚¬ìš©ì„ ìœ„í•œ ëª¨ë“ˆ ë³„ì¹­

class Solution:
    def trapRainWater(self, heightMap: List[List[int]]) -> int:
        m, n = len(heightMap), len(heightMap[0])                 # ê²©ì í¬ê¸° ê³„ì‚°
        if m < 3 or n < 3:                                       # 3x3 ë¯¸ë§Œì´ë©´ ë¬¼ì´ ê³ ì¼ ìˆ˜ ì—†ìŒ
            return 0

        boundary = []                                            # ê²½ê³„ ì…€ë“¤ì„ ë‹´ì„ í™ ì»¨í…Œì´ë„ˆ
        visited = [[False] * n for _ in range(m)]               # ë°©ë¬¸(ìˆ˜ìœ„ í™•ì •) ì—¬ë¶€

        for i in range(m):
            boundary.append((heightMap[i][0], i, 0))            # ì™¼ìª½ ì—´ ê²½ê³„ ì‚½ì…
            boundary.append((heightMap[i][-1], i, n-1))         # ì˜¤ë¥¸ìª½ ì—´ ê²½ê³„ ì‚½ì…
            visited[i][0] = True                                # ê²½ê³„ ë°©ë¬¸ ì²˜ë¦¬
            visited[i][-1] = True

        for j in range(1, n-1):
            boundary.append((heightMap[0][j], 0, j))            # ìœ„ìª½ í–‰ ê²½ê³„(ëª¨ì„œë¦¬ ì œì™¸) ì‚½ì…
            boundary.append((heightMap[-1][j], m-1, j))         # ì•„ë˜ìª½ í–‰ ê²½ê³„(ëª¨ì„œë¦¬ ì œì™¸) ì‚½ì…
            visited[0][j] = True                                # ê²½ê³„ ë°©ë¬¸ ì²˜ë¦¬
            visited[-1][j] = True
        
        hq.heapify(boundary)                                     # ê²½ê³„ë“¤ì„ ìµœì†Œ í™ìœ¼ë¡œ êµ¬ì„±
        answer = 0                                               # ëˆ„ì  ë¬¼ì˜ ì–‘
        dirs = [(1,0), (-1,0), (0,1), (0,-1)]                    # 4ë°©í–¥ ì´ë™ ë²¡í„°
        
        while boundary:                                          # í™ì´ ë¹Œ ë•Œê¹Œì§€ ë°˜ë³µ
            h, x, y = hq.heappop(boundary)                       # ê°€ì¥ ë‚®ì€ ê²½ê³„ ìˆ˜ìœ„ êº¼ëƒ„

            for dx, dy in dirs:                                  # ì´ì›ƒ 4ì¹¸ ìˆœíšŒ
                nx, ny = x + dx, y + dy                          # ì´ì›ƒ ì¢Œí‘œ
                if nx < 0 or nx >= m or ny < 0 or ny >= n or visited[nx][ny]:  # ë²”ìœ„ ë°–/ì´ë¯¸ í™•ì •ì´ë©´ ìŠ¤í‚µ
                    continue
                nh = heightMap[nx][ny]                           # ì´ì›ƒ ê³ ë„
                level = max(h, nh)                               # ì´ì›ƒì˜ ìƒˆ ê²½ê³„ ìˆ˜ìœ„(ë¬¼ì´ ì°¨ë©´ h, ì•„ë‹ˆë©´ nh)
                if nh < h:                                       # ê²½ê³„ë³´ë‹¤ ì´ì›ƒì´ ë‚®ë‹¤ë©´
                    answer += h - nh                             # ê³ ì¸ ë¬¼ ì–‘ì„ ëˆ„ì 
                visited[nx][ny] = True                           # ì´ì›ƒ ìˆ˜ìœ„ í™•ì •
                hq.heappush(boundary, (level, nx, ny))           # ìƒˆ ê²½ê³„ë¡œ í™ì— ì‚½ì…

        return answer                                            # ì´ ë¬¼ì˜ ì–‘ ë°˜í™˜

# -----------------------------------------------------
# ğŸ” ì²« ì‹œë„ ê²°ê³¼:
# - ìµœì†Œ í™ + BFS í™•ì¥ìœ¼ë¡œ ì •ë‹µ í†µê³¼.
#
# ğŸ”§ ì˜¤ë‹µ ì´ìœ  ë° ì‹¤ìˆ˜, ì‚¬ìš©í•œ ì•Œê³ ë¦¬ì¦˜ ê°œë…:
# - í•µì‹¬ ê°œë…: ê²½ê³„ì—ì„œ ì•ˆìª½ìœ¼ë¡œ í¼ì§€ëŠ” **ìš°ì„ ìˆœìœ„ í(ìµœì†Œ í™) ê¸°ë°˜ íƒìƒ‰**.
#   - í™ì—ì„œ êº¼ë‚¸ ë†’ì´ hê°€ í•´ë‹¹ ì¹¸ì˜ **í™•ì • ê²½ê³„ ìˆ˜ìœ„**.
#   - ì´ì›ƒ nh < hë©´ ë¬¼ hâˆ’nhë¥¼ ì±„ìš°ê³ , ìƒˆ ê²½ê³„ëŠ” level=max(h,nh).
# - ì‹¤ìˆ˜ í¬ì¸íŠ¸(ìˆ˜ì • ì™„ë£Œ):
#   1) ì´ì›ƒ ë°©ë¬¸ í‘œì‹œ(visited)ëŠ” **í‘¸ì‹œ ì§ì „**ì— í•´ì•¼ ì¤‘ë³µ í‘¸ì‹œ ë°©ì§€.
#   2) ì´ì›ƒì€ **í•­ìƒ í‘¸ì‹œ**í•´ì•¼ íƒìƒ‰ì´ ì´ì–´ì§. ë¬¼ ë”í•˜ê¸°ëŠ” ì¡°ê±´ë¶€.
#
# ğŸ“š ì‹œê°„Â·ê³µê°„ ë³µì¡ë„:
# - ì‹œê°„: O(mn log(mn))  (ê° ì¹¸ì´ í™ì— ìµœëŒ€ 1íšŒ ì‚½ì…/ì‚­ì œ)
# - ê³µê°„: O(mn)          (visited, í™)
#
# -----------------------------------------------------
# (ì„ íƒ) ë‹¤ë¥¸ íš¨ìœ¨ì ì¸ í’€ì´ ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜ ì œì•ˆ:
# - ë™ì¼ ë¡œì§ì˜ ë°”í…€ì—… êµ¬í˜„ë§Œ ì¡´ì¬. ë³µì¡ë„ ê·¼ë³¸ ê°œì„ ì€ ë¶ˆê°€.
# - ë©”ëª¨ë¦¬ ì ˆì•½: visitedë¥¼ ë¹„íŠ¸ì„¸íŠ¸ë¡œ ëŒ€ì²´ ê°€ëŠ¥(ì–¸ì–´ë³„).
